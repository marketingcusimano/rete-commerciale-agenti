<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Direzionale - Cotto Cusimano</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/lucide@latest/dist/umd/lucide.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #f9fafb 0%, #f3f4f6 50%, #e5e7eb 100%);
            min-height: 100vh;
            position: relative;
        }

        /* Background Effects */
        .bg-effects {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            pointer-events: none;
            opacity: 0.2;
            z-index: 0;
        }

        .bg-effect-1 {
            position: absolute;
            top: -160px;
            right: -160px;
            width: 384px;
            height: 384px;
            background: #3b82f6;
            border-radius: 50%;
            mix-blend-mode: multiply;
            filter: blur(48px);
            animation: pulse 3s ease-in-out infinite;
        }

        .bg-effect-2 {
            position: absolute;
            bottom: -160px;
            left: -160px;
            width: 384px;
            height: 384px;
            background: #6366f1;
            border-radius: 50%;
            mix-blend-mode: multiply;
            filter: blur(48px);
            animation: pulse 3s ease-in-out infinite;
            animation-delay: 2s;
        }

        .bg-effect-3 {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 384px;
            height: 384px;
            background: #06b6d4;
            border-radius: 50%;
            mix-blend-mode: multiply;
            filter: blur(48px);
            animation: pulse 3s ease-in-out infinite;
            animation-delay: 4s;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.8; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.1); }
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
            position: relative;
            z-index: 1;
        }

        /* Header Styles */
        .header {
            margin-bottom: 2rem;
            transform: translateY(-32px);
            opacity: 0;
            animation: slideIn 1s ease-out forwards;
        }

        @keyframes slideIn {
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .header-card {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(40px);
            border-radius: 24px;
            padding: 2rem;
            border: 1px solid #e5e7eb;
            box-shadow: 0 25px 50px -12px rgba(59, 130, 246, 0.1);
        }

        .header-content {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .header-title {
            text-align: center;
        }

        .header-title h1 {
            font-size: 2.5rem;
            font-weight: 900;
            color: #111827;
            letter-spacing: -0.025em;
            margin-bottom: 0.25rem;
        }

        .header-title p {
            color: #6b7280;
            font-size: 1.125rem;
            font-weight: 500;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 0.75rem;
            justify-content: center;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            background: #10b981;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .status-text {
            font-size: 0.75rem;
            color: #059669;
            font-weight: 500;
        }

        .header-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .date-range {
            background: rgba(156, 163, 175, 0.7);
            padding: 0.75rem 1rem;
            border-radius: 12px;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .date-range i {
            width: 16px;
            height: 16px;
            color: #6b7280;
        }

        .date-range span {
            font-size: 0.875rem;
            font-weight: 500;
            color: #374151;
        }

        .header-buttons {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .btn {
            padding: 0.75rem;
            border-radius: 12px;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .btn:hover {
            transform: scale(1.05);
        }

        .btn-primary {
            background: linear-gradient(135deg, #2563eb 0%, #3b82f6 100%);
            color: white;
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #1d4ed8 0%, #2563eb 100%);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #4b5563 0%, #6b7280 100%);
            color: white;
        }

        .btn-secondary:hover {
            background: linear-gradient(135deg, #374151 0%, #4b5563 100%);
        }

        .btn:disabled {
            background: #9ca3af;
            cursor: not-allowed;
            transform: none;
        }

        .btn i {
            width: 20px;
            height: 20px;
        }

        .agents-count {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .agents-count i {
            width: 16px;
            height: 16px;
            color: #6b7280;
        }

        .agents-count span {
            font-size: 0.875rem;
            font-weight: 500;
            color: #374151;
        }

        /* Navigation Tabs */
        .nav-tabs {
            margin-top: 1.5rem;
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
        }

        .nav-tab {
            padding: 0.75rem 1.5rem;
            border-radius: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .nav-tab.active {
            background: linear-gradient(135deg, #2563eb 0%, #3b82f6 100%);
            color: white;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        .nav-tab:not(.active) {
            background: #f3f4f6;
            color: #374151;
            border: 1px solid #d1d5db;
        }

        .nav-tab:not(.active):hover {
            background: #e5e7eb;
        }

        .nav-tab i {
            width: 16px;
            height: 16px;
        }

        /* Region Filters */
        .region-filters {
            margin-top: 1rem;
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
        }

        .region-filter {
            padding: 0.5rem 1rem;
            border-radius: 12px;
            font-weight: 500;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
        }

        .region-filter.active {
            background: #4f46e5;
            color: white;
        }

        .region-filter:not(.active) {
            background: #e5e7eb;
            color: #374151;
        }

        .region-filter:not(.active):hover {
            background: #d1d5db;
        }

        /* Dynamic Title Card */
        .dynamic-title-card {
            background: linear-gradient(135deg, #2563eb 0%, #1e40af 50%, #1d4ed8 100%);
            border-radius: 24px;
            padding: 2rem;
            margin-bottom: 2rem;
            border: 1px solid rgba(59, 130, 246, 0.2);
            box-shadow: 0 25px 50px -12px rgba(59, 130, 246, 0.3);
            position: relative;
            overflow: hidden;
            transform: translateY(32px);
            opacity: 0;
            animation: titleSlideIn 0.8s ease-out forwards;
            animation-delay: 0.2s;
        }

        @keyframes titleSlideIn {
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .title-update-animation {
            animation: titleUpdate 0.6s ease-in-out;
        }

        @keyframes titleUpdate {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }

        .dynamic-title-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, rgba(255, 255, 255, 0.1) 0%, transparent 50%, rgba(255, 255, 255, 0.1) 100%);
            background-size: 200% 200%;
            animation: shimmer 3s ease-in-out infinite;
        }

        @keyframes shimmer {
            0%, 100% { background-position: 0% 0%; }
            50% { background-position: 100% 100%; }
        }

        .dynamic-title-content {
            position: relative;
            z-index: 2;
            display: flex;
            align-items: center;
            justify-content: space-between;
            color: white;
        }

        .dynamic-title-text {
            flex: 1;
        }

        .dynamic-title {
            font-size: 2rem;
            font-weight: 900;
            margin-bottom: 0.5rem;
            letter-spacing: -0.025em;
        }

        .dynamic-subtitle {
            font-size: 1rem;
            color: rgba(255, 255, 255, 0.8);
            font-weight: 500;
        }

        .title-badge {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(16px);
            padding: 1rem 1.5rem;
            border-radius: 16px;
            font-weight: 700;
            font-size: 1.125rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            min-width: 120px;
            text-align: center;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        /* KPI Cards */
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.25rem;
            margin-bottom: 2rem;
        }

        .kpi-card {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(24px);
            border-radius: 24px;
            padding: 1.5rem;
            border: 1px solid #e5e7eb;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            transform: translateY(32px);
            opacity: 0;
            animation: cardSlideIn 0.7s ease-out forwards;
        }

        .kpi-card:nth-child(1) { animation-delay: 0.3s; }
        .kpi-card:nth-child(2) { animation-delay: 0.4s; }
        .kpi-card:nth-child(3) { animation-delay: 0.5s; }
        .kpi-card:nth-child(4) { animation-delay: 0.6s; }
        .kpi-card:nth-child(5) { animation-delay: 0.7s; }

        @keyframes cardSlideIn {
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .kpi-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }

        .kpi-icon {
            padding: 0.5rem;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .kpi-icon i {
            width: 20px;
            height: 20px;
        }

        .kpi-icon.blue {
            background: #dbeafe;
            color: #2563eb;
        }

        .kpi-icon.emerald {
            background: #d1fae5;
            color: #059669;
        }

        .kpi-icon.purple {
            background: #e9d5ff;
            color: #7c3aed;
        }

        .kpi-icon.orange {
            background: #fed7aa;
            color: #ea580c;
        }

        .kpi-icon.cyan {
            background: #cffafe;
            color: #0891b2;
        }

        .kpi-label {
            color: #6b7280;
            font-size: 0.875rem;
            font-weight: 500;
        }

        .kpi-value {
            font-size: 2rem;
            font-weight: 900;
            color: #111827;
            margin-bottom: 0.5rem;
        }

        .kpi-meta {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .kpi-growth {
            color: #059669;
            font-size: 0.875rem;
            font-weight: 700;
        }

        .kpi-comparison {
            color: #6b7280;
            font-size: 0.875rem;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981 0%, #34d399 100%);
            transition: width 1.5s ease-in-out;
            border-radius: 4px;
        }

        /* Charts Grid */
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .chart-card {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(24px);
            border-radius: 24px;
            padding: 2rem;
            border: 1px solid #e5e7eb;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        .chart-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: #111827;
            margin-bottom: 1.5rem;
        }

        .chart-container {
            position: relative;
            height: 300px;
        }

        /* Table Styles */
        .table-card {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(24px);
            border-radius: 24px;
            padding: 2rem;
            border: 1px solid #e5e7eb;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        .table-container {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            text-align: left;
            padding: 1rem;
            font-size: 0.875rem;
            font-weight: 700;
            color: #374151;
            border-bottom: 2px solid #d1d5db;
        }

        th.text-center { text-align: center; }
        th.text-right { text-align: right; }

        td {
            padding: 1rem;
            border-bottom: 1px solid #e5e7eb;
        }

        td.text-center { text-align: center; }
        td.text-right { text-align: right; }

        tr:hover {
            background: #f9fafb;
        }

        .rank-badge {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 0.875rem;
        }

        .rank-1 { background: #d97706; }
        .rank-2 { background: #9ca3af; }
        .rank-3 { background: #f59e0b; }

        .region-name {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .region-name span {
            font-weight: 700;
            color: #111827;
        }

        .agent-count-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            background: #dbeafe;
            color: #1d4ed8;
            font-weight: 700;
            font-size: 0.875rem;
        }

        .growth-positive {
            color: #059669;
            font-weight: 700;
        }

        .performance-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .performance-value {
            font-weight: 700;
            color: #111827;
        }

        .performance-bar {
            width: 64px;
            height: 8px;
            background: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
        }

        .performance-bar-fill {
            height: 100%;
            background: #10b981;
            border-radius: 4px;
        }

        /* Agents Section */
        .agents-grid {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .agents-sidebar {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(24px);
            border-radius: 24px;
            border: 1px solid #e5e7eb;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            overflow: hidden;
            position: sticky;
            top: 2rem;
        }

        .sidebar-header {
            background: linear-gradient(135deg, #2563eb 0%, #3730a3 100%);
            padding: 1.5rem;
            color: white;
        }

        .sidebar-header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .sidebar-title h3 {
            font-size: 1.5rem;
            font-weight: 900;
        }

        .sidebar-subtitle {
            color: #bfdbfe;
            font-size: 0.875rem;
        }

        .sidebar-icon {
            width: 48px;
            height: 48px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .sidebar-icon i {
            width: 24px;
            height: 24px;
        }

        .sidebar-stats {
            padding: 1rem;
            background: #f9fafb;
            border-bottom: 1px solid #e5e7eb;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.75rem;
            text-align: center;
        }

        .stat-value {
            font-size: 1.125rem;
            font-weight: 900;
            color: #111827;
        }

        .stat-label {
            font-size: 0.75rem;
            color: #6b7280;
        }

        .stat-value.emerald { color: #059669; }
        .stat-value.purple { color: #7c3aed; }

        .agents-list {
            max-height: 600px;
            overflow-y: auto;
        }

        .agent-item {
            padding: 1.25rem;
            cursor: pointer;
            transition: all 0.3s ease;
            border-left: 4px solid transparent;
        }

        .agent-item:hover {
            background: #f9fafb;
            border-left-color: #d1d5db;
        }

        .agent-item.selected {
            background: #eff6ff;
            border-left-color: #2563eb;
            box-shadow: inset 0 0 0 1px rgba(37, 99, 235, 0.1);
        }

        .agent-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 0.75rem;
        }

        .agent-rank-container {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .agent-rank {
            width: 40px;
            height: 40px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 0.875rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .crown {
            width: 20px;
            height: 20px;
        }

        .crown.gold { color: #f59e0b; }
        .crown.silver { color: #9ca3af; }
        .crown.bronze { color: #f97316; }

        .selection-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #d1d5db;
            transition: all 0.3s ease;
        }

        .agent-item.selected .selection-indicator {
            background: #2563eb;
            transform: scale(1.1);
        }

        .agent-info h4 {
            font-weight: 700;
            color: #111827;
            font-size: 1rem;
            line-height: 1.2;
        }

        .agent-code {
            color: #6b7280;
            font-size: 0.875rem;
        }

        .agent-location {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 0.25rem;
        }

        .agent-location i {
            width: 12px;
            height: 12px;
            color: #9ca3af;
        }

        .agent-location span {
            color: #6b7280;
            font-size: 0.75rem;
        }

        .agent-metrics {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.5rem;
            padding-top: 0.5rem;
            border-top: 1px solid #f3f4f6;
            text-align: center;
        }

        .metric-value {
            font-size: 0.875rem;
            font-weight: 700;
            color: #111827;
        }

        .metric-label {
            font-size: 0.75rem;
            color: #6b7280;
        }

        .metric-value.green { color: #059669; }
        .metric-value.yellow { color: #d97706; }
        .metric-value.red { color: #dc2626; }

        .agent-progress {
            width: 100%;
            height: 8px;
            background: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 0.75rem;
        }

        .agent-progress-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .agent-progress-fill.green { background: #10b981; }
        .agent-progress-fill.yellow { background: #f59e0b; }
        .agent-progress-fill.red { background: #ef4444; }

        .empty-state {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(24px);
            border-radius: 24px;
            border: 1px solid #e5e7eb;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            height: 600px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
        }

        .empty-state-content {
            max-width: 400px;
        }

        .empty-state-icon {
            width: 96px;
            height: 96px;
            background: #f3f4f6;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1rem;
        }

        .empty-state-icon i {
            width: 48px;
            height: 48px;
            color: #9ca3af;
        }

        .empty-state h3 {
            font-size: 1.5rem;
            font-weight: 700;
            color: #111827;
            margin-bottom: 1rem;
        }

        .empty-state p {
            color: #6b7280;
            margin-bottom: 1rem;
        }

        .ready-indicator {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding-top: 1rem;
        }

        .ready-dot {
            width: 8px;
            height: 8px;
            background: #3b82f6;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .ready-text {
            font-size: 0.875rem;
            color: #2563eb;
            font-weight: 500;
        }

        /* Animation classes */
        .animate-in {
            animation: slideInUp 0.6s ease-out;
        }

        @keyframes slideInUp {
            from {
                transform: translateY(30px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .hidden { display: none !important; }
        .text-center { text-align: center; }
        .font-bold { font-weight: 700; }
        .text-gray-700 { color: #374151; }
        .text-gray-900 { color: #111827; }

        /* Gradient backgrounds for rank badges */
        .rank-gradient-1 {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        }
        
        .rank-gradient-2 {
            background: linear-gradient(135deg, #d1d5db 0%, #9ca3af 100%);
        }
        
        .rank-gradient-3 {
            background: linear-gradient(135deg, #f97316 0%, #ea580c 100%);
        }
        
        .rank-gradient-default {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
        }

        @media (max-width: 1280px) {
            .agents-grid {
                grid-template-columns: 1fr;
            }
            
            .agents-sidebar {
                position: relative;
                top: 0;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            
            .header-title {
                text-align: left;
            }
            
            .header-title h1 {
                font-size: 2rem;
            }
            
            .header-controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .dynamic-title-content {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }
            
            .dynamic-title {
                font-size: 1.5rem;
            }
            
            .kpi-grid {
                grid-template-columns: 1fr;
            }
            
            .charts-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Background Effects -->
    <div class="bg-effects">
        <div class="bg-effect-1"></div>
        <div class="bg-effect-2"></div>
        <div class="bg-effect-3"></div>
    </div>

    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="header-card">
                <div class="header-content">
                    <div class="header-title">
                        <h1>Dashboard Direzionale</h1>
                        <p>Cotto Cusimano - Controllo Rete Vendita</p>
                        <div class="status-indicator">
                            <div class="status-dot"></div>
                            <span class="status-text">Aggiornamento automatico attivo</span>
                        </div>
                    </div>
                    
                    <div class="header-controls">
                        <div class="date-range">
                            <i data-lucide="calendar"></i>
                            <span>01 Gen - 18 Ago 2025</span>
                        </div>

                        <div class="header-buttons">
                            <button class="btn btn-primary" onclick="handleDownload('pdf')" title="Esporta Dashboard PDF">
                                <i data-lucide="download"></i>
                            </button>
                            <button class="btn btn-secondary" onclick="testCSVLoad()" title="Test Caricamento CSV">
                                <i data-lucide="database"></i>
                            </button>
                            <button class="btn btn-secondary" onclick="window.location.reload()" title="Aggiorna Dashboard">
                                <i data-lucide="refresh-cw"></i>
                            </button>
                        </div>

                        <div class="agents-count">
                            <i data-lucide="building-2"></i>
                            <span id="agents-count">3 Agenti Attivi</span>
                        </div>
                    </div>
                </div>
                
                <!-- Navigation Tabs -->
                <div class="nav-tabs">
                    <button class="nav-tab active" onclick="setActiveTab('overview')" id="tab-overview">
                        <i data-lucide="trending-up"></i>
                        Panoramica Aziendale
                    </button>
                    
                    <button class="nav-tab" onclick="setActiveTab('agents')" id="tab-agents">
                        <i data-lucide="users"></i>
                        Dettaglio Agenti
                    </button>
                    
                    <button class="nav-tab" onclick="toggleRegions()" id="toggle-regions">
                        <i data-lucide="map-pin"></i>
                        <span>Mostra Regioni</span>
                    </button>
                </div>

                <!-- Region Filters -->
                <div class="region-filters hidden" id="region-filters">
                    <button class="region-filter active" onclick="setSelectedRegion('all')">
                        Tutte le Regioni
                    </button>
                    <button class="region-filter" onclick="setSelectedRegion('Lazio')">
                        Lazio
                    </button>
                    <button class="region-filter" onclick="setSelectedRegion('Marche')">
                        Marche
                    </button>
                </div>
            </div>
        </div>

        <!-- Overview Tab Content -->
        <div id="overview-content">
            <!-- Dynamic Title Card -->
            <div class="dynamic-title-card" id="dynamic-title-card">
                <div class="dynamic-title-content">
                    <div class="dynamic-title-text">
                        <h2 class="dynamic-title" id="dynamic-title">Dati Aziendali Completi</h2>
                        <p class="dynamic-subtitle" id="dynamic-subtitle">Panoramica generale di tutte le regioni • 3 agenti • 40 clienti</p>
                    </div>
                    <div class="title-badge" id="title-badge">2 Regioni</div>
                </div>
            </div>

            <!-- KPI Cards -->
            <div class="kpi-grid">
                <!-- Fatturato Totale -->
                <div class="kpi-card">
                    <div class="kpi-header">
                        <div class="kpi-icon blue">
                            <i data-lucide="trending-up"></i>
                        </div>
                        <p class="kpi-label">Fatturato 2025</p>
                    </div>
                    <p class="kpi-value" id="fatturato-totale">€198k</p>
                    <div class="kpi-meta">
                        <span class="kpi-growth" id="crescita-percentuale">+25.3%</span>
                        <span class="kpi-comparison">vs 2024</span>
                    </div>
                </div>

                <!-- Performance Obiettivo -->
                <div class="kpi-card">
                    <div class="kpi-header">
                        <div class="kpi-icon emerald">
                            <i data-lucide="target"></i>
                        </div>
                        <p class="kpi-label">Performance</p>
                    </div>
                    <p class="kpi-value" id="performance-totale">77%</p>
                    <div class="progress-bar">
                        <div class="progress-fill" id="performance-bar" style="width: 77%"></div>
                    </div>
                </div>

                <!-- Clienti Totali -->
                <div class="kpi-card">
                    <div class="kpi-header">
                        <div class="kpi-icon purple">
                            <i data-lucide="users"></i>
                        </div>
                        <p class="kpi-label">Clienti Attivi</p>
                    </div>
                    <p class="kpi-value" id="clienti-totali">40</p>
                    <p class="kpi-comparison">Totale portafoglio</p>
                </div>

                <!-- Agenti Attivi -->
                <div class="kpi-card">
                    <div class="kpi-header">
                        <div class="kpi-icon orange">
                            <i data-lucide="building-2"></i>
                        </div>
                        <p class="kpi-label">Agenti</p>
                    </div>
                    <p class="kpi-value" id="agenti-attivi">3</p>
                    <p class="kpi-comparison">Rete vendita</p>
                </div>

                <!-- Regioni Coperte -->
                <div class="kpi-card">
                    <div class="kpi-header">
                        <div class="kpi-icon cyan">
                            <i data-lucide="map-pin"></i>
                        </div>
                        <p class="kpi-label">Regioni</p>
                    </div>
                    <p class="kpi-value" id="regioni-coperte">2</p>
                    <p class="kpi-comparison">Copertura territorio</p>
                </div>
            </div>

            <!-- Charts Overview -->
            <div class="charts-grid">
                <!-- Performance per Regione -->
                <div class="chart-card">
                    <h3 class="chart-title">Performance per Regione</h3>
                    <div class="chart-container">
                        <canvas id="performanceChart"></canvas>
                    </div>
                </div>

                <!-- Distribuzione Fatturato -->
                <div class="chart-card">
                    <h3 class="chart-title">Distribuzione Fatturato</h3>
                    <div class="chart-container">
                        <canvas id="distributionChart"></canvas>
                    </div>
                    
                    <!-- Legenda Distribuzione -->
                    <div id="distribution-legend" style="margin-top: 1rem;">
                        <!-- Legenda sarà popolata dinamicamente -->
                    </div>
                </div>
            </div>

            <!-- Tabella Regioni -->
            <div class="table-card">
                <h3 class="chart-title">Dettaglio per Regione</h3>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Regione</th>
                                <th class="text-center">Agenti</th>
                                <th class="text-right">Fatturato 2025</th>
                                <th class="text-center">vs 2024</th>
                                <th class="text-center">Performance</th>
                                <th class="text-center">Clienti</th>
                            </tr>
                        </thead>
                        <tbody id="regions-table-body">
                            <!-- Righe saranno popolate dinamicamente -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Agents Tab Content -->
        <div id="agents-content" class="hidden">
            <div class="agents-grid">
                <!-- Lista Agenti Sidebar -->
                <div class="agents-sidebar">
                    <!-- Header Lista -->
                    <div class="sidebar-header">
                        <div class="sidebar-header-content">
                            <div class="sidebar-title">
                                <h3>Rete Vendita</h3>
                                <p class="sidebar-subtitle">3 Agenti Attivi</p>
                            </div>
                            <div class="sidebar-icon">
                                <i data-lucide="users"></i>
                            </div>
                        </div>
                    </div>

                    <!-- Statistiche Veloci -->
                    <div class="sidebar-stats">
                        <div class="stats-grid">
                            <div>
                                <div class="stat-value">€198k</div>
                                <div class="stat-label">Fatturato</div>
                            </div>
                            <div>
                                <div class="stat-value emerald">77%</div>
                                <div class="stat-label">Performance</div>
                            </div>
                            <div>
                                <div class="stat-value purple">40</div>
                                <div class="stat-label">Clienti</div>
                            </div>
                        </div>
                    </div>

                    <!-- Lista Agenti -->
                    <div class="agents-list" id="agents-list">
                        <!-- Agenti saranno popolati dinamicamente -->
                    </div>
                </div>

                <!-- Pannello Dettagli Agente -->
                <div class="agent-details">
                    <!-- Stato Vuoto -->
                    <div class="empty-state" id="empty-state">
                        <div class="empty-state-content">
                            <div class="empty-state-icon">
                                <i data-lucide="users"></i>
                            </div>
                            <h3>Seleziona un Agente</h3>
                            <p>Clicca su un agente dalla lista per visualizzare tutti i suoi dati, performance e statistiche dettagliate.</p>
                            <div class="ready-indicator">
                                <div class="ready-dot"></div>
                                <span class="ready-text">Pronto per l'analisi</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Dati dell'applicazione (statici come fallback)
        const agenti = [
            {
                codice: "631.00238",
                nome: "CARABOT NATALINO",
                regione: "Lazio",
                province: ["LT", "RM"],
                fatturato2025: 68178.98,
                fatturato2024: 51000.00,
                obiettivo: 92000.00,
                clienti: 20,
                obiettivoClienti: 29,
                performance: 74,
                rank: 3
            },
            {
                codice: "631.00263",
                nome: "G-2-G SRL",
                regione: "Marche",
                province: ["AN", "PU"],
                fatturato2025: 95420.15,
                fatturato2024: 78500.00,
                obiettivo: 115000.00,
                clienti: 12,
                obiettivoClienti: 18,
                performance: 83,
                rank: 1
            },
            {
                codice: "631.00120",
                nome: "CINTI DOMENICO",
                regione: "Lazio",
                province: ["FR"],
                fatturato2025: 34567.23,
                fatturato2024: 28900.00,
                obiettivo: 45000.00,
                clienti: 8,
                obiettivoClienti: 12,
                performance: 77,
                rank: 2
            }
        ];

        const regioniData = [
            {
                regione: "Lazio",
                agenti: 2,
                fatturato2025: 102746.21,
                fatturato2024: 79900.00,
                obiettivo: 137000.00,
                clienti: 28,
                crescita: 28.6,
                performance: 75
            },
            {
                regione: "Marche",
                agenti: 1,
                fatturato2025: 95420.15,
                fatturato2024: 78500.00,
                obiettivo: 115000.00,
                clienti: 12,
                crescita: 21.5,
                performance: 83
            }
        ];

        // URL del CSV su GitHub
        const CSV_URL = 'https://raw.githubusercontent.com/marketingcusimano/rete-commerciale-agenti/refs/heads/main/docs/csv-concatenato-agenti.csv';
        let csvData = [];
        let isDataLoaded = false;

        // Stato dell'applicazione
        let selectedRegion = 'all';
        let activeTab = 'overview';
        let selectedAgent = null;
        let regionsVisible = false;
        let performanceChart = null;
        let distributionChart = null;

        // Utility functions
        function formatCurrency(value) {
            return new Intl.NumberFormat('it-IT', {
                style: 'currency',
                currency: 'EUR',
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            }).format(value);
        }

        function formatCompactCurrency(value) {
            if (value >= 1000000) return `€${(value / 1000000).toFixed(1)}M`;
            if (value >= 1000) return `€${(value / 1000).toFixed(0)}k`;
            return formatCurrency(value);
        }

        // Funzione per parsificare il CSV
        function parseCSV(csvText) {
            try {
                const lines = csvText.trim().split('\n');
                const headers = lines[0].split(',').map(h => h.trim());
                const data = [];
                
                for (let i = 1; i < lines.length; i++) {
                    const line = lines[i].trim();
                    if (!line) continue;
                    
                    const values = line.split(',').map(v => v.trim());
                    if (values.length >= headers.length) {
                        const row = {};
                        headers.forEach((header, index) => {
                            row[header] = values[index] || '';
                        });
                        data.push(row);
                    }
                }
                
                return data;
            } catch (error) {
                console.error('Errore nel parsing CSV:', error);
                return [];
            }
        }

        // Test di caricamento CSV
        async function testCSVLoad() {
            try {
                console.log('Test caricamento CSV da:', CSV_URL);
                
                const statusIndicators = document.querySelectorAll('.status-text');
                statusIndicators.forEach(indicator => {
                    indicator.textContent = 'Test caricamento CSV...';
                    indicator.style.color = '#f59e0b';
                });
                
                const response = await fetch(CSV_URL);
                console.log('Response status:', response.status);
                console.log('Response ok:', response.ok);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const csvText = await response.text();
                console.log('CSV Text length:', csvText.length);
                console.log('Prime 1000 caratteri:', csvText.substring(0, 1000));
                
                const parsedData = parseCSV(csvText);
                console.log('Dati parsificati:', parsedData.length, 'record');
                
                if (parsedData.length > 0) {
                    console.log('Primo record:', parsedData[0]);
                    console.log('Headers disponibili:', Object.keys(parsedData[0]));
                }
                
                statusIndicators.forEach(indicator => {
                    indicator.textContent = `Test OK: ${parsedData.length} record trovati`;
                    indicator.style.color = '#059669';
                });

                // Mostra alert con risultati
                alert(`Test CSV completato!\n\nRecords trovati: ${parsedData.length}\nHeaders: ${parsedData.length > 0 ? Object.keys(parsedData[0]).join(', ') : 'Nessuno'}\n\nVedi console per dettagli.`);
                
            } catch (error) {
                console.error('Errore test CSV:', error);
                
                const statusIndicators = document.querySelectorAll('.status-text');
                statusIndicators.forEach(indicator => {
                    indicator.textContent = 'Test fallito: ' + error.message;
                    indicator.style.color = '#dc2626';
                });

                alert(`Errore nel test CSV:\n${error.message}\n\nVedi console per dettagli.`);
            }
        }

        function getCurrentTotals() {
            if (selectedRegion === 'all') {
                const totaliAziendali = {
                    fatturato2025: agenti.reduce((sum, a) => sum + a.fatturato2025, 0),
                    fatturato2024: agenti.reduce((sum, a) => sum + a.fatturato2024, 0),
                    obiettivo: agenti.reduce((sum, a) => sum + a.obiettivo, 0),
                    clienti: agenti.reduce((sum, a) => sum + a.clienti, 0),
                    agenti: agenti.length
                };
                totaliAziendali.crescita = ((totaliAziendali.fatturato2025 - totaliAziendali.fatturato2024) / totaliAziendali.fatturato2024 * 100);
                totaliAziendali.performance = Math.round((totaliAziendali.fatturato2025 / totaliAziendali.obiettivo) * 100);
                return totaliAziendali;
            } else {
                const selected = regioniData.find(r => r.regione === selectedRegion);
                return {
                    fatturato2025: selected.fatturato2025,
                    fatturato2024: selected.fatturato2024,
                    obiettivo: selected.obiettivo,
                    clienti: selected.clienti,
                    agenti: selected.agenti,
                    crescita: selected.crescita,
                    performance: selected.performance
                };
            }
        }

        function getFilteredData() {
            if (selectedRegion === 'all') return regioniData;
            return regioniData.filter(r => r.regione === selectedRegion);
        }

        // Update dynamic title based on selected region
        function updateDynamicTitle() {
            const titleElement = document.getElementById('dynamic-title');
            const subtitleElement = document.getElementById('dynamic-subtitle');
            const badgeElement = document.getElementById('title-badge');
            const cardElement = document.getElementById('dynamic-title-card');
            
            if (!titleElement || !subtitleElement || !badgeElement || !cardElement) return;
            
            // Add animation class
            cardElement.classList.add('title-update-animation');
            
            // Remove animation class after animation completes
            setTimeout(() => {
                cardElement.classList.remove('title-update-animation');
            }, 600);
            
            const currentTotals = getCurrentTotals();
            
            if (selectedRegion === 'all') {
                titleElement.textContent = 'Dati Aziendali Completi';
                subtitleElement.textContent = `Panoramica generale di tutte le regioni • ${currentTotals.agenti} agenti • ${currentTotals.clienti} clienti`;
                badgeElement.textContent = `${regioniData.length} Regioni`;
            } else {
                const selectedData = regioniData.find(r => r.regione === selectedRegion);
                if (selectedData) {
                    titleElement.textContent = `Dati ${selectedRegion}`;
                    subtitleElement.textContent = `Focus specifico sulla regione ${selectedRegion} • ${selectedData.agenti} ${selectedData.agenti === 1 ? 'agente' : 'agenti'} • ${selectedData.clienti} clienti`;
                    badgeElement.textContent = selectedRegion;
                }
            }
        }

        // Tab management
        function setActiveTab(tab) {
            activeTab = tab;
            
            // Update tab buttons
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            document.getElementById(`tab-${tab}`).classList.add('active');
            
            // Update content visibility
            document.getElementById('overview-content').classList.toggle('hidden', tab !== 'overview');
            document.getElementById('agents-content').classList.toggle('hidden', tab !== 'agents');
            
            if (tab === 'overview') {
                updateDynamicTitle(); // Update title when returning to overview
                updateOverviewContent();
            } else if (tab === 'agents') {
                updateAgentsContent();
            }
        }

        // Region toggle management
        function toggleRegions() {
            regionsVisible = !regionsVisible;
            const regionFilters = document.getElementById('region-filters');
            const toggleButton = document.getElementById('toggle-regions');
            const toggleSpan = toggleButton.querySelector('span');
            
            if (regionsVisible) {
                regionFilters.classList.remove('hidden');
                regionFilters.classList.add('animate-in');
                toggleSpan.textContent = 'Nascondi Regioni';
                toggleButton.classList.add('active');
            } else {
                regionFilters.classList.add('hidden');
                regionFilters.classList.remove('animate-in');
                toggleSpan.textContent = 'Mostra Regioni';
                toggleButton.classList.remove('active');
            }
        }

        // Region management
        function setSelectedRegion(region) {
            selectedRegion = region;
            
            // Update filter buttons
            document.querySelectorAll('.region-filter').forEach(f => f.classList.remove('active'));
            document.querySelector(`button[onclick="setSelectedRegion('${region}')"]`).classList.add('active');
            
            updateDynamicTitle();
            updateOverviewContent();
        }

        // Update overview content
        function updateOverviewContent() {
            const currentTotals = getCurrentTotals();
            
            // Update KPI cards
            document.getElementById('fatturato-totale').textContent = formatCompactCurrency(currentTotals.fatturato2025);
            document.getElementById('crescita-percentuale').textContent = `+${currentTotals.crescita.toFixed(1)}%`;
            document.getElementById('performance-totale').textContent = `${currentTotals.performance}%`;
            document.getElementById('performance-bar').style.width = `${currentTotals.performance}%`;
            document.getElementById('clienti-totali').textContent = currentTotals.clienti;
            document.getElementById('agenti-attivi').textContent = currentTotals.agenti;
            document.getElementById('regioni-coperte').textContent = selectedRegion === 'all' ? regioniData.length : 1;
            document.getElementById('agents-count').textContent = `${currentTotals.agenti} Agenti Attivi`;
            
            // Update charts
            if (typeof Chart !== 'undefined' && activeTab === 'overview') {
                setTimeout(updateCharts, 200);
            }
            
            updateRegionsTable();
        }

        // Update charts with safe error handling
        function updateCharts() {
            try {
                updatePerformanceChart();
                updateDistributionChart();
            } catch (error) {
                console.warn('Errore aggiornamento grafici:', error);
            }
        }

        function updatePerformanceChart() {
            try {
                const canvas = document.getElementById('performanceChart');
                if (!canvas) return;
                
                const ctx = canvas.getContext('2d');
                const data = getFilteredData();
                
                if (performanceChart) {
                    performanceChart.destroy();
                    performanceChart = null;
                }
                
                performanceChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: data.map(d => d.regione),
                        datasets: [{
                            label: 'Performance %',
                            data: data.map(d => d.performance),
                            backgroundColor: '#3b82f6',
                            borderRadius: 8,
                            borderSkipped: false,
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: {
                            y: {
                                beginAtZero: true,
                                grid: { color: '#e5e7eb', drawBorder: false },
                                ticks: { color: '#6b7280', font: { size: 12 } }
                            },
                            x: {
                                grid: { display: false },
                                ticks: { color: '#6b7280', font: { size: 11 } }
                            }
                        }
                    }
                });
            } catch (error) {
                console.warn('Errore performance chart:', error);
            }
        }

        function updateDistributionChart() {
            try {
                const canvas = document.getElementById('distributionChart');
                if (!canvas) return;
                
                const ctx = canvas.getContext('2d');
                const data = getFilteredData();
                const colors = ['#dc2626', '#ea580c', '#d97706', '#ca8a04', '#65a30d', '#16a34a'];
                
                if (distributionChart) {
                    distributionChart.destroy();
                    distributionChart = null;
                }
                
                distributionChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: data.map(d => d.regione),
                        datasets: [{
                            data: data.map(d => d.fatturato2025),
                            backgroundColor: colors.slice(0, data.length),
                            borderWidth: 2,
                            borderColor: '#fff'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } }
                    }
                });
                
                updateDistributionLegend(data, colors);
            } catch (error) {
                console.warn('Errore distribution chart:', error);
            }
        }

        function updateDistributionLegend(data, colors) {
            const currentTotals = getCurrentTotals();
            const legendContainer = document.getElementById('distribution-legend');
            
            if (!legendContainer) return;
            
            legendContainer.innerHTML = data.map((regione, index) => `
                <div style="display: flex; align-items: center; justify-content: space-between; padding: 0.75rem; background: #f9fafb; border-radius: 12px; margin-bottom: 0.75rem;">
                    <div style="display: flex; align-items: center; gap: 0.75rem;">
                        <div style="width: 16px; height: 16px; border-radius: 50%; background: ${colors[index]}; flex-shrink: 0;"></div>
                        <div>
                            <p style="font-size: 0.875rem; font-weight: 700; color: #111827; margin: 0;">${regione.regione}</p>
                            <p style="font-size: 0.75rem; color: #6b7280; margin: 0;">${regione.agenti} agenti • ${regione.clienti} clienti</p>
                        </div>
                    </div>
                    <div style="text-align: right;">
                        <p style="font-size: 0.875rem; font-weight: 700; color: #111827; margin: 0;">${formatCompactCurrency(regione.fatturato2025)}</p>
                        <p style="font-size: 0.75rem; color: #6b7280; margin: 0;">
                            ${((regione.fatturato2025 / currentTotals.fatturato2025) * 100).toFixed(1)}%
                        </p>
                    </div>
                </div>
            `).join('');
        }

        function updateRegionsTable() {
            const tbody = document.getElementById('regions-table-body');
            if (!tbody) return;
            
            const data = getFilteredData().sort((a, b) => b.fatturato2025 - a.fatturato2025);
            
            tbody.innerHTML = data.map((regione, index) => `
                <tr>
                    <td>
                        <div class="region-name">
                            <div class="rank-badge rank-${index + 1}">${index + 1}</div>
                            <span>${regione.regione}</span>
                        </div>
                    </td>
                    <td class="text-center">
                        <span class="agent-count-badge">${regione.agenti}</span>
                    </td>
                    <td class="text-right">
                        <span class="font-bold text-gray-900">${formatCurrency(regione.fatturato2025)}</span>
                    </td>
                    <td class="text-center">
                        <span class
